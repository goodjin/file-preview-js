# PDF预览器与DocumentAdapter集成测试计划

## 测试目标

验证PDF预览器与DocumentAdapter的集成功能，确保：
1. 完整业务流程的正确性
2. 各种PDF文件类型的兼容性
3. 控制功能的稳定性
4. 错误处理的健壮性
5. 性能指标的合理性

## 测试范围

### 1. 核心流程测试

#### 1.1 基本流程
- **测试ID**: TC-001
- **测试名称**: 文件上传→文件类型检测→DocumentAdapter适配→PDF预览器渲染
- **前置条件**: 无
- **测试步骤**:
  1. 创建PDF文件对象
  2. 调用DocumentAdapter.getFileExtension()检测文件类型
  3. 调用DocumentAdapter.parse()解析文件
  4. 创建PDF预览器实例
  5. 调用previewer.load()加载文件
  6. 验证加载状态和基本信息
- **预期结果**: 流程顺利执行，无错误，PDF正确渲染
- **优先级**: P0

### 2. 文件类型测试

#### 2.1 文件类型检测
- **测试ID**: TC-002
- **测试名称**: 不同文件类型的正确识别
- **测试用例**:
  - test.pdf (正确)
  - test.PDF (正确，大小写)
  - document.pdf (正确)
  - test.txt (拒绝)
  - test.jpg (拒绝)
  - test.docx (拒绝)
- **预期结果**: 只接受.pdf文件，其他类型正确拒绝
- **优先级**: P0

### 3. PDF文件类型测试

#### 3.1 单页PDF
- **测试ID**: TC-003
- **测试名称**: 单页PDF预览
- **测试数据**: 50KB单页PDF
- **预期结果**: 正确加载和渲染，总页数为1
- **优先级**: P0

#### 3.2 多页PDF
- **测试ID**: TC-004
- **测试名称**: 多页PDF预览和翻页
- **测试数据**: 500KB多页PDF（10页+）
- **测试步骤**:
  1. 加载多页PDF
  2. 渲染第1页
  3. 渲染第5页
  4. 渲染最后一页
  5. 测试previousPage()
  6. 测试nextPage()
- **预期结果**: 所有页面正常渲染，翻页功能正常
- **优先级**: P0

#### 3.3 大文件PDF
- **测试ID**: TC-005
- **测试名称**: 大文件PDF加载和渲染
- **测试数据**: 10MB以上PDF
- **性能指标**:
  - 加载时间 < 5秒
  - 内存占用合理
  - 进度显示正常
- **预期结果**: 大文件正常加载，性能可接受
- **优先级**: P1

#### 3.4 加密PDF (待测)
- **测试ID**: TC-006
- **测试名称**: 加密PDF文件处理
- **测试数据**: 有密码保护的PDF
- **预期结果**: 提示用户需要密码或友好错误提示
- **优先级**: P2

### 4. 控制功能测试

#### 4.1 缩放功能
- **测试ID**: TC-007
- **测试名称**: 缩放控制
- **测试用例**:
  - setScale(0.5) - 50%
  - setScale(0.75) - 75%
  - setScale(1.0) - 100%
  - setScale(1.5) - 150%
  - setScale(2.0) - 200%
  - zoomIn() - 逐级放大
  - zoomOut() - 逐级缩小
- **预期结果**: 所有缩放级别正常工作，渲染质量良好
- **优先级**: P0

#### 4.2 翻页功能
- **测试ID**: TC-008
- **测试名称**: 页面导航
- **测试用例**:
  - goToPage(0) - 跳转到首页
  - goToPage(totalPages/2) - 跳转到中间页
  - goToPage(totalPages-1) - 跳转到末页
  - previousPage() - 上一页（包括边界）
  - nextPage() - 下一页（包括边界）
- **预期结果**: 所有翻页功能正常，边界处理正确
- **优先级**: P0

#### 4.3 滚动功能
- **测试ID**: TC-009
- **测试名称**: 页面滚动查看
- **测试数据**: 大尺寸页面PDF
- **预期结果**: 可以正常滚动查看完整页面
- **优先级**: P1

### 5. 错误处理测试

#### 5.1 非PDF文件
- **测试ID**: TC-010
- **测试名称**: 上传非PDF文件
- **测试用例**:
  - .txt文件
  - .jpg文件
  - .docx文件
- **预期结果**: 正确识别并拒绝，显示友好错误提示
- **优先级**: P0

#### 5.2 损坏的PDF文件
- **测试ID**: TC-011
- **测试名称**: 损坏或格式错误的PDF
- **测试用例**:
  - 无PDF头的文件
  - 截断的PDF
  - 损坏的PDF结构
- **预期结果**: 捕获错误并显示友好提示，不崩溃
- **优先级**: P0

#### 5.3 空文件
- **测试ID**: TC-012
- **测试名称**: 空文件或零字节文件
- **预期结果**: 正确处理，显示错误提示
- **优先级**: P1

### 6. 集成测试

#### 6.1 数据传递
- **测试ID**: TC-013
- **测试名称**: DocumentAdapter与PDF预览器的数据传递
- **测试步骤**:
  1. DocumentAdapter.parse()解析PDF
  2. 验证返回的ArrayBuffer数据
  3. 将数据传递给PDF预览器
  4. 验证预览器正确处理数据
- **预期结果**: 数据正确传递和处理
- **优先级**: P0

#### 6.2 完整流程集成
- **测试ID**: TC-014
- **测试名称**: 完整业务流程集成测试
- **测试步骤**:
  1. 模拟文件上传
  2. 文件类型检测
  3. DocumentAdapter适配
  4. PDF预览器渲染
  5. 用户交互（缩放、翻页）
  6. 资源清理
- **预期结果**: 完整流程顺畅，无异常
- **优先级**: P0

### 7. 性能测试

#### 7.1 加载性能
- **测试ID**: TC-015
- **测试名称**: 不同大小文件的加载时间
- **测试数据**:
  - 100KB文件: < 500ms
  - 1MB文件: < 1s
  - 10MB文件: < 5s
- **预期结果**: 符合性能指标
- **优先级**: P1

#### 7.2 渲染性能
- **测试ID**: TC-016
- **测试名称**: 页面渲染速度
- **测试指标**:
  - 单页渲染时间 < 200ms
  - 多页连续渲染流畅
- **预期结果**: 渲染流畅，无明显卡顿
- **优先级**: P1

#### 7.3 内存使用
- **测试ID**: TC-017
- **测试名称**: 内存占用和释放
- **测试步骤**:
  1. 加载大文件
  2. 记录内存占用
  3. 调用destroy()
  4. 验证内存释放
- **预期结果**: 内存占用合理，正确释放
- **优先级**: P2

### 8. 兼容性测试

#### 8.1 浏览器兼容性
- **测试ID**: TC-018
- **测试名称**: 不同浏览器的兼容性
- **测试浏览器**:
  - Chrome 90+
  - Firefox 88+
  - Safari 14+
  - Edge 90+
- **预期结果**: 在所有目标浏览器正常运行
- **优先级**: P1

## 测试环境

### 硬件环境
- CPU: 双核及以上
- 内存: 4GB及以上
- 网络: 稳定的互联网连接（用于加载PDF.js）

### 软件环境
- 操作系统: Windows 10+, macOS 10.15+, Linux (Ubuntu 20.04+)
- 浏览器: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- 测试工具: 自定义集成测试框架

### 测试数据
- 单页PDF: 50KB
- 多页PDF: 500KB (10页)
- 大文件PDF: 10MB (100页+)
- 非PDF文件: .txt, .jpg, .docx
- 损坏PDF: 无PDF头的二进制文件

## 测试执行

### 自动化测试
- 使用 `tests/integration/pdf-document-adapter-integration.test.js`
- 在浏览器中打开 `tests/integration/runner.html`
- 点击"运行所有测试"执行自动化测试

### 手动测试
1. 打开 `src/implementations/document/pdf/demo.html`
2. 上传不同类型的PDF文件进行手动验证
3. 测试各种控制功能
4. 记录发现的问题

### 真实文件测试
使用测试运行器的"上传真实PDF文件测试"功能，测试实际使用场景。

## 测试结果记录

### 测试结果格式
```json
{
  "timestamp": "2024-01-29T10:00:00Z",
  "summary": {
    "total": 18,
    "passed": 16,
    "failed": 2,
    "skipped": 0,
    "passRate": "88.89%"
  },
  "results": [
    {
      "name": "基本流程测试",
      "status": "pass",
      "message": "文件上传→类型检测→DocumentAdapter适配→PDF预览器渲染 流程成功",
      "metrics": {
        "document-adapter-parse": 45.2,
        "pdf-previewer-load": 1256.8
      },
      "timestamp": "2024-01-29T10:00:01Z"
    }
  ]
}
```

### 问题跟踪
使用以下格式记录发现的问题：
```
[问题ID] 问题描述
- 严重程度: P0/P1/P2
- 复现步骤: ...
- 实际结果: ...
- 预期结果: ...
- 截图/日志: ...
```

## 测试通过标准

### P0测试
- 通过率: 100%
- P0级测试必须全部通过

### P1测试
- 通过率: >= 90%
- 允许少量非关键问题

### P2测试
- 通过率: >= 80%
- 不影响核心功能

### 性能标准
- 加载时间符合预期指标
- 内存占用合理
- 无明显性能瓶颈

## 回归测试

当以下情况发生时需要执行回归测试：
1. PDF预览器代码修改
2. DocumentAdapter代码修改
3. 新增功能或接口变更
4. 修复P0/P1级bug后

## 测试交付物

1. 集成测试报告 (Markdown)
2. 测试结果JSON文件
3. 问题清单 (如有)
4. 性能测试数据
5. 测试截图或日志 (如有问题)

## 附录

### A. 术语表
- **DocumentAdapter**: 文档适配器，负责解析不同格式的文档文件
- **PDFPreviewer**: PDF预览器，负责PDF文件的渲染和控制
- **集成测试**: 测试多个组件协同工作的测试

### B. 参考资料
- PDF预览器API文档: `src/implementations/document/pdf/README.md`
- DocumentAdapter代码: `src/adapters/DocumentAdapter.js`
- PDF.js文档: https://mozilla.github.io/pdf.js/

### C. 联系方式
- 测试负责人: 测试智能体 (4c4a28fe-5259-4aa6-bca6-5f9017215f5c)
- 文档模块负责人: e7a4c249-6133-4219-a325-9412f1537968
- 适配器开发: 221d53f3-7ba0-4cd1-98fc-8558f616cc7b

---

**文档版本**: 1.0
**创建日期**: 2024-01-29
**维护者**: 测试负责人
