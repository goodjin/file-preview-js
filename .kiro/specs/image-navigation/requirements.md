# 工件管理器图片导航功能需求文档

## 1. 功能概述

在工件管理器中查看图片时，增加图片导航功能，允许用户通过左右切换按钮或键盘左右方向键浏览其他图片，无需关闭当前图片查看器。

## 2. 用户故事

### 2.1 作为用户，我希望在查看图片时能够快速切换到下一张图片
**验收标准：**
- 在图片查看器中显示"下一张"按钮
- 点击"下一张"按钮后，显示列表中的下一张图片
- 如果当前是最后一张图片，按钮应该禁用或循环到第一张

### 2.2 作为用户，我希望在查看图片时能够快速切换到上一张图片
**验收标准：**
- 在图片查看器中显示"上一张"按钮
- 点击"上一张"按钮后，显示列表中的上一张图片
- 如果当前是第一张图片，按钮应该禁用或循环到最后一张

### 2.3 作为用户，我希望使用键盘方向键来切换图片
**验收标准：**
- 按下键盘右方向键时，切换到下一张图片
- 按下键盘左方向键时，切换到上一张图片
- 键盘导航只在图片查看器打开时生效

### 2.4 作为用户，我希望看到所有图片的缩略图
**验收标准：**
- 在图片查看器底部显示所有图片的缩略图导航栏
- 当前查看的图片在缩略图中高亮显示
- 点击缩略图可以直接跳转到对应图片
- 缩略图栏可以横向滚动
- 自动滚动以保持当前图片的缩略图可见

## 3. 功能需求

### 3.1 缩略图导航栏
- 在图片查看器底部显示缩略图导航栏
- 缩略图高度：80px（使用CSS变量 `--thumbnail-height` 定义）
- 缩略图宽度：根据图片比例自适应
- 单行横向排列，支持横向滚动
- 当前图片的缩略图应该有明显的高亮标识（如边框高亮）
- 自动滚动以保持当前图片可见
- 缩略图应该清晰可辨认

### 3.2 左右箭头按钮
- 在图片内容区域的左右两侧显示箭头按钮
- 按钮样式：半透明背景，鼠标悬停时高亮
- 按钮位置：垂直居中，不遮挡图片关键内容
- 点击左箭头切换到上一张，点击右箭头切换到下一张

### 3.3 键盘导航
- 监听键盘左右方向键事件
- 只在图片查看器打开且当前查看的是图片时响应
- 不与其他快捷键冲突（如ESC关闭）
- 到达边界时循环切换（第一张←最后一张，最后一张→第一张）

### 3.4 图片列表过滤
- 导航功能应该只在图片类型的工件之间切换
- 应该考虑当前的搜索和过滤条件
- 工作空间模式和工件模式应该分别处理

### 3.5 边界处理
- 使用缩略图导航，用户可以直观看到所有图片
- 键盘和箭头按钮导航到达边界时循环切换

## 4. 非功能需求

### 4.1 性能
- 切换图片应该流畅，无明显延迟
- 缩略图加载应该优化（懒加载或虚拟滚动）
- 预加载相邻图片以提升体验
- 大量图片时不应该影响页面性能

### 4.2 可用性
- 缩略图应该清晰可辨认
- 当前图片的高亮标识应该明显
- 键盘操作应该直观
- 提供视觉反馈（如缩略图hover效果）
- 缩略图栏不应该遮挡主图片内容

### 4.3 兼容性
- 不影响现有的图片查看功能
- 不影响其他类型工件的查看
- 与现有的键盘快捷键兼容

## 5. 技术约束

### 5.1 代码结构
- 修改应该集中在 `ArtifactManager` 类中
- 可能需要修改 `ImageViewer` 组件以支持缩略图导航
- 保持代码的模块化和可维护性
- 缩略图导航栏可以作为独立组件实现

### 5.2 数据管理
- 需要维护当前图片在过滤后列表中的索引
- 需要获取过滤后的所有图片列表
- 需要为每个缩略图生成合适的URL
- 需要跟踪缩略图的加载状态

## 6. 实现方案（已确认）

### 6.1 缩略图导航栏方案
在图片查看器底部显示所有图片的缩略图导航栏。

**功能特性：**
- 显示当前过滤条件下所有图片的缩略图
- 当前查看的图片在缩略图中高亮显示
- 点击缩略图可以直接跳转到对应图片
- 支持键盘左右方向键切换图片（循环模式）
- 缩略图栏可以横向滚动（单行显示，非网格）
- 自动滚动以保持当前图片的缩略图可见
- 在图片两侧显示左右箭头按钮辅助导航

**设计参数：**
- 缩略图高度：80px（使用CSS变量定义，便于调整）
- 缩略图宽度：自适应图片比例
- 布局：单行横向排列，支持滚动
- 边界行为：循环切换（第一张←跳到最后一张，最后一张→跳到第一张）
- 箭头按钮：显示在图片内容区域的左右两侧

**实现要点：**
- 使用CSS变量定义缩略图尺寸（如 `--thumbnail-height: 80px`）
- 当前图片标识：边框高亮或特殊样式
- 滚动行为：自动滚动到当前图片位置
- 性能优化：使用懒加载或虚拟滚动（图片数量较多时）
- 箭头按钮：悬浮在图片两侧，半透明背景，鼠标悬停时高亮

**优点：**
- 直观展示所有可用图片
- 可以快速跳转到任意图片
- 清晰显示当前位置
- 符合常见图片查看器的使用习惯
- 多种导航方式（缩略图点击、键盘、箭头按钮）

## 7. 已确认的设计决策

1. **缩略图尺寸**：80px 高度，使用CSS变量定义（便于后续调整）
2. **布局方式**：单行横向排列，支持横向滚动
3. **边界行为**：循环切换（第一张←最后一张，最后一张→第一张）
4. **导航方式**：
   - 缩略图点击
   - 键盘左右方向键
   - 左右箭头按钮（显示在图片两侧）
5. **预加载策略**：预加载相邻图片以提升切换体验

## 8. 待确认问题

1. ~~边界行为：到达第一张/最后一张时，是禁用按钮还是循环？~~ （已确认：循环）
2. ~~导航按钮位置：在对话框底部还是图片两侧？~~ （已确认：缩略图导航栏 + 左右箭头按钮）
3. ~~是否需要预加载相邻图片？~~ （已确认：是）
4. ~~是否需要显示缩略图导航栏？~~ （已确认：是）
5. ~~缩略图的具体尺寸？~~ （已确认：80px 高度）
6. ~~是否需要左右箭头按钮辅助导航？~~ （已确认：是）
7. ~~缩略图布局方式？~~ （已确认：单行横向，非网格）

## 8. 验收测试

### 8.1 基本功能测试
- [ ] 打开图片时，底部显示缩略图导航栏
- [ ] 缩略图导航栏显示所有图片的缩略图（单行横向）
- [ ] 当前图片的缩略图有明显的高亮标识
- [ ] 点击缩略图能够切换到对应图片
- [ ] 图片两侧显示左右箭头按钮
- [ ] 点击左箭头切换到上一张图片
- [ ] 点击右箭头切换到下一张图片
- [ ] 按下右方向键能够切换到下一张图片
- [ ] 按下左方向键能够切换到上一张图片
- [ ] 切换图片后，缩略图高亮状态正确更新

### 8.2 滚动和定位测试
- [ ] 缩略图栏可以横向滚动
- [ ] 切换图片时，自动滚动以保持当前缩略图可见
- [ ] 缩略图栏的滚动流畅，无卡顿

### 8.3 边界测试
- [ ] 第一张图片时，左方向键循环到最后一张
- [ ] 最后一张图片时，右方向键循环到第一张
- [ ] 第一张图片时，左箭头按钮循环到最后一张
- [ ] 最后一张图片时，右箭头按钮循环到第一张
- [ ] 只有一张图片时，缩略图栏仍然正常显示
- [ ] 只有一张图片时，箭头按钮和键盘导航正确处理
- [ ] 没有图片时不显示缩略图导航栏和箭头按钮

### 8.4 过滤测试
- [ ] 搜索过滤后，缩略图栏只显示过滤结果中的图片
- [ ] 扩展名过滤后，缩略图栏只显示过滤结果中的图片
- [ ] 工作空间模式下，缩略图栏只显示当前工作空间的图片
- [ ] 过滤条件改变后，缩略图栏正确更新

### 8.5 性能测试
- [ ] 大量图片（50+）时，缩略图加载不影响页面性能
- [ ] 切换图片流畅，无明显延迟
- [ ] 缩略图栏滚动流畅

### 8.6 样式和可配置性测试
- [ ] 缩略图高度使用CSS变量定义
- [ ] 修改CSS变量可以调整缩略图尺寸
- [ ] 箭头按钮样式符合设计要求（半透明背景）
- [ ] 箭头按钮鼠标悬停时有高亮效果
- [ ] 缩略图栏不遮挡主图片内容
- [ ] 箭头按钮不过度遮挡图片内容

### 8.7 兼容性测试
- [ ] 不影响非图片类型工件的查看
- [ ] ESC键仍然能够关闭查看器
- [ ] 其他快捷键不受影响
- [ ] 缩略图栏不遮挡主图片内容

## 9. 后续优化

- 支持触摸滑动切换图片（移动端）
- 添加图片缩放功能
- 添加图片旋转功能
- 支持幻灯片播放模式
- 缩略图懒加载优化
- 虚拟滚动支持（大量图片时）
- 缩略图预加载策略优化
