# 需求文档

## 简介

本功能实现工具函数的分组管理机制。当前系统中所有岗位（Role）都拥有完全相同的工具函数集合，这导致：
1. 智能体可能调用不应该使用的工具
2. LLM 上下文中包含大量不相关的工具定义，浪费 token
3. 无法根据岗位职责精细化控制工具权限

本功能将工具函数按功能分组，每个模块向工具组管理器提供一组工具。在创建岗位时可以指定该岗位可使用的工具组。工具组的目的是**降低技术复杂度**，而非限制智能体能力。通过只展示相关工具，帮助智能体更专注于任务。

## 术语表

- **工具组（Tool_Group）**: 由模块提供的一组相关工具函数的集合，有唯一标识符
- **工具组管理器（Tool_Group_Manager）**: 管理所有工具组的中央组件，接收模块提供的工具组
- **模块（Module）**: 提供工具组的功能单元，每个模块向工具组管理器注册一个工具组
- **岗位（Role）**: 定义智能体的职责和行为，包含工具组配置
- **智能体（Agent）**: 智能体实例，绑定到特定岗位，只能看到岗位配置的工具函数
- **运行时（Runtime）**: 协调智能体、消息和工具调用的核心组件

## 需求

### 需求 1：模块提供工具组

**用户故事：** 作为模块开发者，我希望我的模块能向工具组管理器提供一组工具，以便这些工具可以被岗位选择性使用。

#### 验收标准

1. 每个模块应能向工具组管理器注册一个工具组
2. 工具组应包含唯一标识符（通常与模块名相同）和工具定义列表
3. 模块应在加载时自动向工具组管理器注册其工具组
4. 工具组管理器应支持运行时动态注册工具组
5. 当模块卸载时，其工具组应从工具组管理器中移除

### 需求 2：内置工具组

**用户故事：** 作为系统管理员，我希望系统提供内置的核心工具组，以便基础功能可以正常使用。

#### 验收标准

1. 运行时应提供以下内置工具组：
   - `org_management`：组织管理工具（find_role_by_name、create_role、spawn_agent、spawn_agent_with_task、terminate_agent、send_message）
   - `artifact`：工件管理工具（put_artifact、get_artifact）
   - `workspace`：工作空间工具（read_file、write_file、list_files、get_workspace_info）
   - `command`：命令执行工具（run_command、run_javascript）
   - `network`：网络工具（http_request）
   - `context`：上下文管理工具（compress_context、get_context_status）
   - `console`：控制台工具（console_print）
2. 内置工具组应在运行时初始化时自动注册到工具组管理器
3. 内置工具组的标识符应为保留名称，模块不能使用相同标识符

### 需求 3：岗位工具组配置

**用户故事：** 作为智能体开发者，我希望在创建岗位时指定工具组，以便该岗位的智能体只看到相关的工具，降低技术复杂度。

#### 验收标准

1. 当创建岗位时，create_role 工具应接受可选的 `toolGroups` 参数，类型为工具组标识符数组
2. root 岗位的工具组应硬编码为 `["org_management"]`，因为 root 不需要执行具体任务
3. 非 root 岗位如果未指定 toolGroups，默认应提供全部工具组
4. 岗位应在其元数据中存储配置的工具组
5. 在岗位提示词中应强调配置工具组的重要性，但未配置时不应影响智能体执行任务

### 需求 4：智能体工具可见性

**用户故事：** 作为智能体，我希望只看到我岗位配置的工具，以便不会被不相关的工具干扰，专注于任务。

#### 验收标准

1. 当为智能体构建 LLM 上下文时，运行时应只包含来自智能体岗位配置的工具组的工具定义
2. 运行时应合并所有配置工具组的工具定义，不产生重复
3. 当智能体尝试调用不在其配置工具组中的工具时，运行时应拒绝调用并返回错误消息
4. 错误消息应指明尝试调用的工具名称以及该工具对此岗位不可用

### 需求 5：工具组查询

**用户故事：** 作为系统管理员，我希望查询工具组信息，以便了解系统中有哪些工具组和工具。

#### 验收标准

1. 工具组管理器应提供列出所有可用工具组的方法
2. 工具组管理器应提供获取特定工具组中工具的方法
3. 工具组管理器应提供查找工具所属工具组的方法
4. 当查询工具组时，结果应包含工具组标识符、描述和工具数量

### 需求 6：用户界面工具组管理

**用户故事：** 作为用户，我希望在岗位属性界面中修改岗位的工具组配置，以便可以灵活调整岗位的工具可见性。

#### 验收标准

1. 当用户打开岗位属性界面时，系统应显示该岗位当前配置的工具组列表
2. 岗位属性界面应显示所有可用的工具组供用户选择
3. 当用户修改工具组配置时，系统应验证新配置的有效性
4. 当用户保存工具组配置时，系统应更新岗位元数据并持久化
5. 界面应显示每个工具组包含的工具列表，以便用户了解工具组内容
6. 如果用户清空所有工具组，系统应提示将使用默认的全部工具组
